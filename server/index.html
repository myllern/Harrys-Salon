<html>
<meta charset="UTF-8"> 

<head>
<title>Testing</title>
</head>

<script type="module">

import { ServerApi } from 'http://localhost:8080/server_api.js';

let sever = new ServerApi();

async function run_test()
{
  console.log("Testing the server");
  
  //let sever = new ServerApi();
  
  console.log( await sever.add_user("huvud", "Huvud Hårig") );
  
  console.log( await sever.sign_in("test") );
  console.log( await sever.sign_in("huvud") );
  
  console.log( await sever.list_admin() );
  
  console.log( await sever.add_admin("Liemannen") );
  console.log( await sever.add_admin("Skalle-Per") );
  
  console.log( await sever.list_admin() );
  
  console.log( await sever.list_schedule() );
  console.log( await sever.list_schedule("Skalle-Per") );
  
  console.log( await sever.reserve("Skalle-Per", 3) );
  console.log( await sever.reserve("Skalle-Per", 3) );
  
  console.log( await sever.list_schedule("Skalle-Per") );
  
  console.log( await sever.add_user("test") );
  console.log( await sever.sign_in("test") );
  console.log( await sever.cancel("Skalle-Per", 3) );
  
  console.log( await sever.list_schedule("Skalle-Per") );
  
  console.log( await sever.sign_in("huvud") );
  console.log( await sever.list_schedule("Skalle-Per") );
  console.log( await sever.cancel("Skalle-Per", 3) );
  console.log( await sever.list_schedule("Skalle-Per") );
  
  console.log( await sever.reserve("Skalle-Per", 3) );
  console.log( await sever.reserve("Skalle-Per", 0) );
  
  console.log( await sever.sign_in("test") );
  console.log( await sever.reserve("Skalle-Per", 1) );
  console.log( await sever.reserve("Liemannen", 0) );
  console.log( await sever.reserve("Liemannen", 4) );
  
  console.log( await sever.list_schedule() );
  
  console.log( await sever.sign_in("Liemannen") );
  console.log( await sever.list_schedule() );
  
  console.log( await sever.cancel("Skalle-Per", 3) );
  console.log( await sever.cancel("Skalle-Per", 1) );
  console.log( await sever.cancel("Liemannen", 4) );
  console.log( await sever.list_schedule() );
  
  await sever.sign_out();
}

window.run_test = run_test;

const set_color = (color, text) => `<span style='color:${color}'>${text}</span>`

function _print( obj )
{
  if ( Array.isArray(obj) )
  {
    let ret = "[";
    
    obj.forEach( (item, index) => {
      if ( index )
        ret += ", ";
      ret += `${_print(item)}`
    });
    
    return ret + "]";
  }
  
  if ( typeof obj == "object" )
  {
    let ret = "{";
    
    for (let name in obj)
      ret += `<br><span style="margin-left:10px">"${name}</span>" : ${_print(obj[name])}`
    
    return ret + "<br>}";
  }
  
  switch (typeof obj)
  {
    case "boolean": return set_color(obj ? "black":"red", obj);
    
    case "string": return set_color("green", obj);
    
    case "number": return set_color("purple", obj);
    
    default: return set_color("gray", obj);
  }
}

function print( obj )
{
  //console.log("The results", obj);
  document.getElementById("output").innerHTML = obj
}

function window_add_template_string(type, allow_empty=false)
{
  window[type] = async function()
  {
    let text = document.getElementById(type).value;
    if ( ! allow_empty && ! text.length )
    {
      print( set_color("red", "Missing data!!") );
      return;
    }
    
    let text2 = document.getElementById(type+"_2");
    text2 = text2 ? text2.value : null;
    
    let res = text2 ? await sever[type](text, text2) :
                      await sever[type](text);;
    
    if (text2)
      text += "\", \"" + text2 + "";
    
    print(`${set_color("blue", "server."+type)}("${set_color("green",text)}") return:<br>${_print(res)}`);
  }
}

window_add_template_string("sign_in");
window_add_template_string("sign_out", true);
window_add_template_string("add_user");
window_add_template_string("add_admin");
window_add_template_string("list_admin", true);
window_add_template_string("list_schedule", true);
window_add_template_string("reserve");
window_add_template_string("cancel");

</script>

<body>
  Utvecklingssida för kommunikationen med servern.
  <div>
    <button onclick=run_test()>Kör testprogrammet</button>
  </div>

  <div style="margin-top:50px">
  Manuell testning...<br><br>
  let sever = new ServerApi();
  </div>

  <div style="margin-top:50px">
  Server output:
  </div>
  <div id=output style="border:1px solid black;display:inline-block;min-width:400px;min-height:200px"></div>

  <div>
    <h5>Sign-in user</h5>
    <input id=sign_in type=text />
    <button onclick=sign_in()>Sign-in user</button>
  </div>
  
  <div>
    <h5>Sign-out user</h5>
    <input id=sign_out type=text style="display:none" />
    <button onclick=sign_out()>Sign-out user</button>
  </div>

  <div>
    <h5>Create a new user</h5>
    <div><i>User name & optional full name.</i></div>
    <input id=add_user type=text />
    <input id=add_user_2 type=text />
    <button onclick=add_user()>Add user</button>
  </div>

  <div>
    <h5>Create a new admin</h5>
    <div><i>Admin user name & optional full name.</i></div>
    <input id=add_admin type=text />
    <input id=add_admin_2 type=text />
    <button onclick=add_admin()>Add admin</button>
  </div>
  
  <div>
    <h5>List admin</h5>
    <input id=list_admin type=text style="display:none" />
    <button onclick=list_admin()>List admin</button>
  </div>
  
  <div>
    <h5>List schedule</h5>
    <div><i>Specifik admin, eller tomt fält för att visa samtliga.</i></div>
    <input id=list_schedule type=text />
    <button onclick=list_schedule()>List schedule</button>
  </div>
  
  <div>
    <h5>Reserve</h5>
    <div><i>Specifik admin (admin user name eller admin full name) & tidslucka.</i></div>
    <input id=reserve type=text />
    <input id=reserve_2 type=number />
    <button onclick=reserve()>Reserve</button>
  </div>
  
  <div>
    <h5>Cancel</h5>
    <div><i>Specifik admin (admin user name eller admin full name) & tidslucka.</i></div>
    <input id=cancel type=text />
    <input id=cancel_2 type=number />
    <button onclick=cancel()>Cancel</button>
  </div>

</body>

</html>
